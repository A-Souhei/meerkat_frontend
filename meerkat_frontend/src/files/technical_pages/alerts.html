<div class="top-bar row">

	<div class="location-box box">
		<a href="#menu-toggle" id="menu-toggle">
		<div class="location-box__label">
			<div>Location:</div>
			<div id="location-title">Jordan</div>
		</div>
		<span class="glyphicon glyphicon-chevron-right"></span>
		<span class="glyphicon glyphicon-chevron-left hidden"></span>
		</a>
	</div>
	<div class="tab-title hidden-xs col-sm-5 col-md-6">
		Alerts
	</div>
	<div id="epi-week-title" class="col-xs-12 col-sm-4 col-md-3 pull-right box ">
		Date not loaded.
	</div>

</div>

<div class="demographics toggled" id="wrapper">

	<div id="sidebar-wrapper" >
		<div id="location-selector" class="location-selector">
			Locations not loaded
		</div>
	</div>

	<div id="page-content-wrapper">
		<div class="row">
			<div class="col-xs-12 less-padding-col"><div class="chart box">
				<div class="chart__heading">
					Selection Table
				</div>
				<div class="chart__content">
					<div id="alert-agg-table" class="table">
					</div>
				</div>
			</div></div>
		</div>

		<div class="row">
			<div class="col-xs-12 less-padding-col"><div class="chart box">
				<div class="chart__heading">
					Info Table
				</div>
				<div class="chart__content">
					<div id="alert-table" class="table" >
					</div>
				</div>
			</div></div>
		</div>

	</div>
</div>
<div class="breaker"></div>

<!-- Menu Toggle Script -->
<script>
$("#menu-toggle").click(function(e) {
	e.preventDefault();
	$("#wrapper").toggleClass("toggled");
	$(".location-box .glyphicon").toggleClass( "hidden" );

	//Hack to resize highcharts upon side bar toggle. Call window resize() upon transition finish.
	var transitionEvent = whichTransitionEvent();
	transitionEvent && document.getElementById('sidebar-wrapper').addEventListener(transitionEvent, function() {
		$(window).resize();
	});
});
$("#epi-week-title").html( "Week "+get_epi_week() + " Â· " + get_date() );

//This function is called every time a new location is loaded.
//Any location-dependant content should be redrawn through this function.
function drawCharts( locID ){
	
	//Whenever a new location is loaded, go back to a complete alerts table (i.e. unfiltered)
	loadAlertTables(undefined, locID);

}

function loadAlertTables( reason, locID ){
	
	//locID (the id of the location) is an optional argument.  
	//If it isn't set, look at the current page state locID, if that isn't set, default to 1.
	if( typeof locID == 'undefined' ){
		if( history.state === null || typeof history.state.locID == 'undefined' ) locID = 1;
		else locID = history.state.locID;
	}

	$.getJSON( api_root+"/variables/moh", function( variables ){
			
		$.getJSON( api_root+"/aggregate_alerts?location="+locID, function( aggData ){
			drawAlertAggTable('alert-agg-table', aggData, variables);
		});

		//Assemble the correct url, so that reason can be an optional argument.
		var url = api_root+"/alerts?location=" + locID;
		if( typeof reason !== 'undefined' ){
			url += "&reason=" + reason;
		}

		$.getJSON( url, function( data ) {
			drawAlertsTable( "alert-table", data.alerts, variables );
		});
	});
}

</script>
