<div class="top-bar row">

	<div class="location-box box">
		<a href="#menu-toggle" id="menu-toggle">
			<div class="location-box__label">
				<div id="location_box"></div>
				<div id="location-title" class="location-title"></div>
			</div>
			<span class="glyphicon glyphicon-chevron-right"></span>
			<span class="glyphicon glyphicon-chevron-left hidden"></span>
		</a>
	</div>
	<div class="tab-title hidden-xs col-sm-5 col-md-5" id="diseaseTitle">
	</div>
	<div id="epi-week-title" class="col-xs-12 col-sm-4 col-md-3 pull-right box ">
	</div>
</div>

<div class="disease toggled" id="wrapper">

	<div id="sidebar-wrapper" >
		<div id="location-selector" class="location-selector">
		</div>
	</div>

	<div id="page-content-wrapper">
		<div class="row">
			<div class="col-xs-12 less-padding-col">
				<div class="chartBox box">
					<div class="chartBox__heading" id="box_heading">
					</div>
					<div id="diseaseInfo" class="chartBox__content diseaseInfo">
					</div>
					<div id="disease-table" class="table">
					</div>
				</div>
			</div>
		</div>

		<div class="row">
			<div class="col-xs-12 less-padding-col">
				<div class="chartBox box">
					<div class="chartBox__heading" id="box_2_heading">
					</div>
					<div class="chartBox__content">
						<div id="time-chart" class="chart">
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="row">
			<div class="col-xs-12 less-padding-col">
				<div class="chartBox box">
					<div class="chartBox__heading" id="box_3_heading">
					</div>
					<div id="disease-map" class="chartBox__content map">
						
					</div>
				</div>
			</div>
		</div>

	</div>
</div>
<div class="breaker"></div>

<!-- Menu Toggle Script -->
<script>
 $("#location_box").html(i18n.gettext("Location:"));
 $("#location_title").html(i18n.gettext("Not Loaded"));
 $("#epi-week-title").html(i18n.gettext('Date not loaded.'));
 $("#location-selector").html(i18n.gettext('Locations not loaded'));
 $("#box_heading").html(i18n.gettext('Information'));
 $("#box_2_heading").html(i18n.gettext('Time of reports'));
 $("#box_3_heading").html(i18n.gettext('Location of reports'));

 
$("#menu-toggle").click(function(e) {
	e.preventDefault();
	$("#wrapper").toggleClass("toggled");
	$(".location-box .glyphicon").toggleClass( "hidden" );
	
	//Hack to resize highcharts upon side bar toggle. Call window resize() upon transition finish.
	var transitionEvent = whichTransitionEvent();
	transitionEvent && document.getElementById('sidebar-wrapper').addEventListener(transitionEvent, function() {
		$(window).resize();
	});
});

$("#epi-week-title").html( i18n.gettext("Week")+ " " + get_epi_week() + " Â· " + get_date() );

var disease = 1;

function buildHTML( title, data, id, colWidth ){

	if( ( data != '' ) && ( typeof(data) != 'undefined' )  ){

		var html = '';

		if( typeof( colWidth ) != 'undefined' ){
			html += ' <div class="diseaseInfo col-xs-12 col-sm-' + colWidth + '">';
		}else{
			html += ' <div class="diseaseInfo col-xs-12">';
		}

		html += '<div class="diseaseInfo__title">';
		html += title;
		html += '</div><div id="' + id + '" class="diseaseInfo__content">'
		html += data;
		html += '</div></div>';

		$( '#diseaseInfo' ).append(html);

	}
}

function drawDiseaseContent( varID, locID ){

	disease = varID;

    	drawMap( varID, 'disease-map', locID );	

	$.getJSON( api_root + '/variable/' + varID, function( data ){

		$('#diseaseTitle').text( i18n.gettext(data.name));

		buildHTML( i18n.gettext('Classification'), i18n.gettext(data.classification_casedef), 'classification', 4 ); 
		buildHTML( i18n.gettext('Source'), i18n.gettext(data.source), 'source', 4 );
		buildHTML( i18n.gettext('Alerts'), i18n.gettext(data.alert_desc), 'diseaseAlerts', 4 );
		buildHTML( i18n.gettext('Case Definition'), i18n.gettext(data.case_def), 'caseDefinition' );
		buildHTML( i18n.gettext('Risk Factor(s)'), i18n.gettext(data.risk_factors), 'riskFactors' );
		buildHTML( i18n.gettext('Sign(s)/Symptom(s)'), i18n.gettext(data.symptoms), 'signsSymptoms' );
		buildHTML( i18n.gettext('Labs/Diagnostics'), i18n.gettext(data.labs_diagnostics), 'signsSymptoms' );
		//If the variable being called is a ICD10 "Chapter" show a table of sub diseases. 
		drawDiseaseTable( varID, locID );
	});

}

function drawDiseaseTable( varID, locID ){

	$.getJSON( api_root + '/variable/' + varID, function( data ){

		console.log( data )
		//If the variable being called is a ICD10 "Chapter" show a table of sub diseases. 
		if( data.id.indexOf('icc_') > -1 || data.id.indexOf('icb_') > -1){

			$.getJSON( api_root+"/aggregate_category/" + data.name + "/" + locID, function( subdiseases ){
				$.getJSON( api_root+"/variables/" + data.name, function( variables ){
                                       
					console.log( Object.keys(subdiseases).length );
                                     
                                        var title = data.name.charAt(0).toUpperCase() + data.name.slice(1);
                                        if( Object.keys(subdiseases).length > 0){
                   				var dataObject = makeDataObject(subdiseases, variables, get_epi_week(), "ICD10 Sub-diseases" );
          		 			dataObject = stripEmptyRecords( dataObject );

                                                drawTable( 'disease-table', dataObject, true, 'loadDisease' );
                                        }
				});
			});
		}
	});
}

//Every tab needs a draw charts function that is called when loading a new location.
function drawCharts( locID ){
	//Keep week abstracted out of the chart drawing process.
	//In case we want the use to eb able to select the weeks to view.
	var week = (get_epi_week()-1).toString();
        drawTimeChart( disease, locID, 'time-chart' )
        
        if(map){
            map.remove();
            drawMap( disease, 'disease-map', locID );
        }
	drawDiseaseTable( disease, locID );

}


</script>
