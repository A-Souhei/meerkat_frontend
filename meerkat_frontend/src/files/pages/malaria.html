<div class="top-bar row">

	<div class="location-box box">
		<a href="#menu-toggle" id="menu-toggle">
			<div class="location-box__label">
				<div id="location_box"></div>
				<div id="location-title" class="location-title"></div>
			</div>
			<span class="glyphicon glyphicon-chevron-right"></span>
			<span class="glyphicon glyphicon-chevron-left hidden"></span>
		</a>
	</div>
	<div class="less-padding-col tab-title hidden-xs col-sm-5 col-md-5" id="title">
	</div>
	<div id="epi-week-title" class="col-xs-12 col-sm-12 col-md-3 pull-right box ">
	</div>

</div>
<div class="malaria toggled" id="wrapper">

	<div id="sidebar-wrapper" >
		<div id="location-selector" class="location-selector">
		</div>
	</div>

	<div id="page-content-wrapper">
		<div class="row">
			<div class="col-xs-12 less-padding-col">
				<div class="chartBox box">
					<div class="chartBox__heading">
                        <p id="box_heading"></p>
					</div>
					<div class="chartBox__content row">
                        <div class='col-xs-12 col-md-3'>
                            <div class='indicator-selector'>
                                <span class='glyphicon glyphicon-chevron-down' onclick="$('.indicator-selector .indicator').toggleClass('show');"></span>
                            </div>
                        </div>
                        <div class='col-xs-12 col-md-9'>
                            <div class='indicator-charts'>
                            </div>
                        </div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="breaker"></div>

<!-- Menu Toggle Script -->
<script>

// We need to be able to translate the contents of the html page.
// Text is inserted here using the javascript translator.
$("#location_box").html(i18n.gettext("Location:"));
$("#location_title").html(i18n.gettext("Not Loaded"));
$("#title").html(i18n.gettext('Malaria'));
$("#epi-week-title").html(i18n.gettext('Date not loaded.'));
$("#location-selector").html(i18n.gettext('Locations not loaded'));
$("#box_heading").html(i18n.gettext('Indicators'));
$("#epi-week-title").html(i18n.gettext("Week")+" "+get_epi_week() + " Â· " + get_date());

// This code expands and shrinks the locations selector.
$("#menu-toggle").click(function(e) {
    e.preventDefault();
	$("#wrapper").toggleClass("toggled");
	$(".location-box .glyphicon").toggleClass("hidden");
	//Hack to resize highcharts upon side bar toggle. Call window resize() upon transition finish.
	var transitionEvent = whichTransitionEvent();
	transitionEvent && document.getElementById('sidebar-wrapper').addEventListener(transitionEvent, function() {
		$(window).resize();
	});
});

var indicators =  [{
        name: "Number of Cases",
        id: "number-of-cases",
        drawChart: function(id, locID){
            function prep(data){
                    var output = [];
                    var keys = Object.keys(data.weeks);
                    for(var k in keys) output.push([keys[k], data.weeks[k]]);
                    return output;
            }
            var confirmed, unconfirmed = {};
            var deferreds = [
                $.getJSON(api_root+'/aggregte_year/cmd_17/'+locID, function(data){confirmed=prep(data);}),
                $.getJSON(api_root+'/aggregate_year/cmd_29/'+locID, function(data){unconfirmed=prep(data);})
            ];
            $.when.apply($, deferreds).then(function(){
                $('.indicator-charts').append("<div class='chart " + id + "' id='" + id + "'></div>");
                Highcharts.chart(id, {
                    chart: {type: 'spline'},
                    title:{text: undefined},
                    plotOptions: {spline: {marker: {enabled: false}}},
                    xAxis: {title: {text:'Epi-week'}},
                    yAxis: {title: {text:'Cases'}},
                    series: [{
                        name: 'Confirmed Cases',
                        data: confirmed
                    }, {
                        name: 'Unconfirmed Cases',
                        data: unconfirmed
                    }]
                });
            });
        }
    },{
        name: "Number of RDT",
        id: "number-of-rdt",
        drawChart: function(id, locID){$('.indicator-charts').append("<div class='chart hidden " + id + "'>Hello rdt</div>");}
    },{
        name: "Number of ACT",
        id: "number-of-act",
        drawChart: function(id, locID){$('.indicator-charts').append("<div class='chart hidden " + id + "'>Hello act</div>");}
    }
]

function loadIndicator(id){
    $('.indicator-selector .indicator').removeClass('selected show');
    $('.indicator-selector .'+id).addClass('selected');
    $('.indicator-charts .chart').addClass('hidden');
    $('.indicator-charts .'+id).removeClass('hidden');
}

function mobileDropDown(){

}

//This function is called every time a new location is loaded.
//Any location-dependant content should be redrawn through this function.
function drawCharts(locID){
    for(var i in indicators){
        $('.indicator-selector').append(
            "<div class='indicator "  + indicators[i].id +
            "' onclick='loadIndicator(\"" + indicators[i].id + "\");'>" +
            indicators[i].name + "</div>"
        );
        indicators[i].drawChart(indicators[i].id, locID);
    }
    loadIndicator(indicators[0].id);
}

</script>
