{% extends 'reports/base.html' %}

{% macro table(data, percent=False) %}
{% set total=[] %}
<table class="refugee centered table table-hover table-condensed"> 
    <tr>
	{% set counter=0 %}

        {% set labels = {"reg": _("Health Directorates"),
                        "tot": _("Total no. <br> of patients"),
                        "gen_1": _("females"),
                        "gen_2": _("males"),
                        "lab_4": _("overweight <br> (BMI > 25)"),
                        "lab_5": _("obese <br> (BMI > 30)"),
                        "lab_2": _('controlled patients <br> (BP < 140/90)'),
                        "lab_7": _('with controlled FBS <br>(Fasting Glucose < 7 mmol/l)'),
                        "lab_9": _('with controlled <br >HbA1c (< 7%%)'),
                        "com_1": _('with diabetes'),
                        "com_2": _("with hypertension"),
                        "smo_2": _('smokers'),
                        "lab_11": _('with complications')
        } %}
	{% for key in data.titles %}
	{% if key == "reg" %}
        <th class="key"> {{ labels[key]|safe }} </th>
	{% elif key == "tot" %}
	<th class="total"> {{ labels[key]|safe }} </th>
	{% do total.append(counter) %}
	{% else %}
        <th>
            {% if key in labels.keys() %}
              {{ labels[key]|safe }}
            {% else %}
              {{ key }}
            {% endif %}
            {% if percent %}
             (%)
            {% endif %}
        </th>

	{% set counter = counter +1%}
	{% endif %}
	
	{% endfor %}
    </tr>
    {% for row in data["data"] %}
    <tr>
	{% if row.title == "Total" %}
	<td class="key total" style="text-align: center;"> {{ _(row.title)  }}</td>
	{% else %}
	<td class="total"> {{ _(row.title)  }}</td>
	{% endif %}
	{% for i in range(row["values"]|length) %}
	{% if (total and i in total)%}
	<td class="total"> {{ row["values"][i]}} </td>        
        {% elif row.title == "Total" %}
        {% if percent %}
        <td class="total"> {{ row["values"][i][0] }} ({{ row["values"][i][1]|float|round(1) }} %)</td>
        {% else %}
        <td class="total"> {{ row["values"][i] }} </td>
        {% endif %}
	{% else %}
        {% if percent %}
	<td> {{ row["values"][i][0]}} ({{row["values"][i][1]|float|round(1) }} %) </td>
        {% else %}
	<td> {{ row["values"][i] }} </td>
        {% endif %}
	{% endif %}
	{% endfor %}
    </tr>
    {% endfor %}
</table>
{%- endmacro %}



{% block title %}{{report.data.project_region|e}} &middot; Non-Commuinicable Diseases Report  &middot; Week {{ report.data.epi_week_num }}{% endblock title %}
{% block body %}
<!-- CONTENT -->
<div class="page-header">
    <h2>     <span 
	  class="flag-icon flag-icon-{{report.flag}}"
	  style="background-image: url(/static/img/flags/4x3/{{report.flag}}.svg) !important;"
      >
      </span> 
        <span class="hidden-xs">{{report.data.project_region|e}} &middot; </span> {{ _('Non Communciable Diseases Report') }}
    <span class="report-week">
        {{ report.data.start_date|datetime_from_json|datetime('dd MMMM YYYY') }} - {{ report.data.end_date|datetime_from_json|datetime('dd MMMM YYYY') }}
    </span>
  </h2>
</div>
<div class="row">
  <!-- Hypertension -->
  <div class="cols-sm-12">
    <div class="chart-wrapper">
      <div class="chart-title">{{ _('Hypertension') }}</div>
      <div class="table-title">{{ _('Table 1: Number of hypertension patients by age group') }}</div>
      <div class="table-wrapper table-responsive">
	  {{ table(report["hypertension"]["age"]) }}
      </div>
      <div class="table-title">{{ _('Table 2: Distribution of hypertension patients') }}</div>
      <div class="table-wrapper table-responsive">
	  {{ table(report["hypertension"]["complications"], percent=True) }}
      </div>
    </div>
  </div>
</div>

<!-- Diabetes -->
<div class="row">
   <div class="cols-sm-12">
    <div class="chart-wrapper">
      <div class="chart-title">{{ _('Diabetes') }}</div>
      <div class="table-title">{{ _('Table 1: Number of diabetes patients by age group') }}</div>
      <div class="table-wrapper table-responsive">
	  {{ table(report["diabetes"]["age"]) }}
      </div>
      <div class="table-title">{{ _('Table 2: Distribution of diabetes patients') }} </div>
      <div class="table-wrapper table-responsive">
	  {{ table(report["diabetes"]["complications"], percent=True) }}
      </div>
    </div>
  </div>
</div>

{% endblock body %}
{% block extra_js %}
<!-- JAVASCRIPT DATA FOR CHARTS -->
{% endblock extra_js %}

