{% extends 'reports/base.html' %}

{% macro table(data, percent=False) %}
{% set total=[] %}
<table class="refugee centered table table-hover table-condensed"> 
    <tr>
	{% set counter=0 %}

        {% set labels = {"reg": "Health Directorates",
                        "tot": "Total no. of patients",
                        "gen_1": "females",
                        "gen_2": "males",
                        "lab_1": "overweight (BMI > 25)",
                        "lab_2": "obese (BMI > 30)",
                        "lab_3": 'controlled patients <br>(Systolic BP < 140)',
                        "lab_4": 'with controlled FBS <br>(Fasting Glucose < 130)',
                        "lab_5": 'with controlled HbA1c (< 7%)',
                        "com_1": 'with diabetes',
                        "com_2": "with hypertension",
                        "smo_2": 'smokers',
                        "lab_6": 'with complications'
        } %}
	{% for key in data.titles %}
	{% if key == "reg" %}
        <th class="key"> {{ labels[key]|e }} </th>
	{% elif key == "tot" %}
	<th class="total"> {{ labels[key]|e }} </th>
	{% do total.append(counter) %}
	{% else %}
        <th>
            {% if key in labels.keys() %}
              {{ labels[key]|safe }}
            {% else %}
              {{ key }}
            {% endif %}
            {% if percent %}
             (%)
            {% endif %}
        </th>

	{% set counter = counter +1%}
	{% endif %}
	
	{% endfor %}
    </tr>
    {% for row in data["data"] %}
    <tr>
	{% if row.title == "Total" %}
	<td class="key total" style="text-align: center;"> {{ row.title  }}</td>
	{% else %}
	<td class="total"> {{ row.title  }}</td>
	{% endif %}
	{% for i in range(row["values"]|length) %}
	{% if (total and i in total)%}
	<td class="total"> {{ row["values"][i]}} </td>        
        {% elif row.title == "Total" %}
        {% if percent %}
        <td class="total"> {{ row["values"][i][0] }} ({{ row["values"][i][1]|float|round(1) }} %)</td>
        {% else %}
        <td class="total"> {{ row["values"][i] }} </td>
        {% endif %}
	{% else %}
        {% if percent %}
	<td> {{ row["values"][0]}} ({{row["values"][i][1]|float|round(1) }} %) </td>
        {% else %}
	<td> {{ row["values"][i] }} </td>
        {% endif %}
	{% endif %}
	{% endfor %}
    </tr>
    {% endfor %}
</table>
{%- endmacro %}



{% block title %}{{report.data.project_region|e}} &middot; Non-Commuinicable Diseases Report  &middot; Week {{ report.data.epi_week_num }}{% endblock title %}
{% block body %}
<!-- CONTENT -->
<div class="page-header">
  <h2><span class="flag-icon flag-icon-{{report.flag}}"></span> <span class="hidden-xs">{{report.data.project_region|e}} &middot; </span> Non Communciable Diseases Report
    <span class="report-week">
        {{ report.data.start_date|datetime_from_json|datetime('%-d %B %Y') }} - {{ report.data.end_date|datetime_from_json|datetime('%-d %B %Y') }}
    </span>
  </h2>
</div>
<div class="row">
  <!-- Hypertension -->
  <div class="cols-sm-12">
    <div class="chart-wrapper">
      <div class="chart-title">Hypertension</div>
      <div class="table-title">Table 1: Number of hypertension patients by age group</div>
      <div class="table-wrapper table-responsive">
	  {{ table(report["hypertension"]["age"]) }}
      </div>
      <div class="table-title">Table 2: Distribution of hypertension patients</div>
      <div class="table-wrapper table-responsive">
	  {{ table(report["hypertension"]["complications"], percent=True) }}
      </div>
    </div>
  </div>
</div>

<!-- Diabetes -->
<div class="row">
   <div class="cols-sm-12">
    <div class="chart-wrapper">
      <div class="chart-title">Diabetes</div>
      <div class="table-title">Table 1: Number of diabetes patients by age group</div>
      <div class="table-wrapper table-responsive">
	  {{ table(report["diabetes"]["age"]) }}
      </div>
      <div class="table-title">Table 2: Distribution of diabetes patients </div>
      <div class="table-wrapper table-responsive">
	  {{ table(report["diabetes"]["complications"], percent=True) }}
      </div>
    </div>
  </div>
</div>

{% endblock body %}
{% block extra_js %}
<!-- JAVASCRIPT DATA FOR CHARTS -->
{% endblock extra_js %}

