{% extends 'reports/base.html' %}

{% macro table(data, percent=True, p_keys="nationalities", s_keys="genders", it_names="gen_vals" ) %}
<table class="refugee centered table table-hover">

    <!-- header of a table -->
    <tr>
        <th class="key mh-cell" colspan="2"></th><!-- first column for main key -->
        {% for p_key in data[0][p_keys] %}
            <th class="key mh-column-title">{{p_key.type}}</th>
        {% endfor %}
    </tr>
    <!-- row entries, e.g. nationalities -->
    {% for mh_row in data %}
            {% for n in range(5) %}
            <tr>
                <!-- in each row we have entry for given gender across all column cateogries -->
                <!-- now we go through each column entry which contains a breakdown by gender... in rows -->
                <!-- heading -->
                {% if mh_row[p_keys][0][s_keys][n] == "Male" %}
                    <th class="key mh-cell" rowspan="5"> {{mh_row.name}} </th>
                    <th class="key mh-cell">{{mh_row[p_keys][0][s_keys][n]}}</th>
                {% elif mh_row[p_keys][0][s_keys][n] == "Total" %}
                    <th class="total mh-cell">{{mh_row[p_keys][0][s_keys][n]}}</th>
                {% else %}
                    <th class="key mh-cell">{{mh_row[p_keys][0][s_keys][n]}}</th>
                {% endif %}

                <!-- data in "sub rows" -->
                {% for category in mh_row[p_keys] %}
                    {% if n==4 %}
                        <td class="total mh-cell">{{category[it_names][n]|int}}</td>
                    {% elif category.type=="Totals" and (n==1 or n==3) %}
                        <td class="total mh-cell">{{category[it_names][n]|int}}%</td>
                    {% elif category.type=="Totals" and (n==0 or n==2) %}
                        <td class="total mh-cell">{{category[it_names][n]|int}}</td>
                        {% elif n==1 or n==3 %}
                        <td class="value mh-cell">{{category[it_names][n]|int}}%</td>
                    {% else %}
                        <td class="value mh-cell">{{category[it_names][n]|int}}</td>
                    {% endif %}
                {% endfor %}

            </tr>
            {% endfor %}
    {% endfor %}


</table>
{%- endmacro %}

{% block title %}{{report.data.project_region|e}} &middot; Mental Health Report  &middot; Week {{ report.data.epi_week_num }}{% endblock title %}
{% block body %}
<!-- CONTENT -->
<div class="page-header">
    <h2>     <span
	  class="flag-icon flag-icon-{{report.flag}}"
	  style="background-image: url(/static/img/flags/4x3/{{report.flag}}.svg) !important;"
      >
      </span>
    <img class="moh-title-logo" src="/static/img/{{content['footer']['logos']['country_partner']}}">
        <span class="hidden-xs">{{report.data.project_region|e}} &middot; </span> {{ _('Mental Health Report') }}
    <span class="report-week">
        {{ report.data.start_date|datetime_from_json|datetime('dd MMMM YYYY') }} - {{ report.data.end_date|datetime_from_json|datetime('dd MMMM YYYY') }}
    </span>
  </h2>
</div>

<div class="row">
  <!-- Visit type / Nationality -->
  <div class="col-sm-12">
    <div class="chart-wrapper">
      <div class="chart-title mh-chart-title">{{ _('Visit type by nationality') }}</div>
      <div class="table-title">{{ _('Table 1: Patients nationality on different visit types.') }}</div>
      <div class="table-wrapper table-responsive">
          {{ table(report["table_1_data"], percent=True, p_keys="visit_types", s_keys="genders", it_names="gen_vals") }}
      </div>
    </div>
  </div>
</div>

<div class="row mh-row">
  <!-- Visit type / Age -->
  <div class="col-sm-12">
    <div class="chart-wrapper">
      <div class="chart-title mh-chart-title">{{ _('Visit type by age') }}</div>
      <div class="table-title">{{ _('Table 2: Breakdown of patients age and gender') }}</div>
      <div class="table-wrapper table-responsive">
          {{ table(report["table_2_data"], percent=True, p_keys="visit_types", s_keys="genders", it_names="gen_vals") }}
      </div>
    </div>
  </div>
</div>

<div class="row mh-row">
  <!-- Governate / nationality -->
  <div class="col-sm-12">
    <div class="chart-wrapper">
      <div class="chart-title mh-chart-title">{{ _('Nationality by governorate') }}</div>
      <div class="table-title">{{ _('Table 3: Nationality of patients with reported mental health condition in each governate.') }}</div>
      <div class="table-wrapper table-responsive">
          {{ table(report["table_3_data"], percent=True, p_keys="regions", s_keys="genders", it_names="gen_vals") }}
      </div>
    </div>
  </div>
</div>
<div class="row mh-row">
  <!-- Governate / age -->
  <div class="col-sm-12">
    <div class="chart-wrapper">
      <div class="chart-title mh-chart-title">{{ _('Age by governorate') }}</div>
      <div class="table-title">{{ _('Table 4: Age of patients with reported mental health condition in each governate.') }}</div>
      <div class="table-wrapper table-responsive">
          {{ table(report["table_4_data"], percent=True, p_keys="regions", s_keys="genders", it_names="gen_vals") }}
      </div>
    </div>
  </div>
</div>

<div class="row mh-row">
  <!-- Diseases / nationality -->
  <div class="col-sm-12">
    <div class="chart-wrapper">
      <div class="chart-title mh-chart-title">{{ _('Nationality by condition') }}</div>
      <div class="table-title">{{ _('Table 5: Patients nationality per disease.') }}</div>
      <div class="table-wrapper table-responsive">
          {{ table(report["table_5_data"], percent=True, p_keys="diseases", s_keys="genders", it_names="gen_vals") }}
      </div>
    </div>
  </div>
</div>
<div class="row mh-row">
  <!-- Diseases / age -->
  <div class="col-sm-12">
    <div class="chart-wrapper">
      <div class="chart-title mh-chart-title">{{ _('Age by condition') }}</div>
      <div class="table-title">{{ _('Table 6: Age of patients with different conditions.') }}</div>
      <div class="table-wrapper table-responsive">
          {{ table(report["table_6_data"], percent=True, p_keys="diseases", s_keys="genders", it_names="gen_vals") }}
      </div>
    </div>
  </div>
</div>

{% endblock body %}
{% block extra_js %}
<!-- JAVASCRIPT DATA FOR CHARTS -->
{% endblock extra_js %}
