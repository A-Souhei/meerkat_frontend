{% extends 'reports/base.html' %}

{% macro table(data, percent=True, p_keys="nationalities", s_keys="genders", it_names="gen_vals" ) %}
<table class="refugee centered table table-hover">
    <!-- header of a table -->
    <tr>
        <th></th>
        {% for p_key in data[0][p_keys] %}
            <th class="key" colspan="5">{{p_key.name}}</th>
        {% endfor %}
    </tr>
    <tr>
        <th></th>
        {% for p_key in data[0][p_keys] %}
            {% for sec_key in p_key[s_keys] %}
                {% if sec_key == "Total" %}
                    <th class="total">{{sec_key}}</th>
                {% else %}
                    <th class="key">{{sec_key}}</th>
                {% endif %}
            {% endfor %}
        {% endfor %}
    </tr>
    <!-- row values -->
    {% for visit_type in data %}
    <tr>
        <td class="value"> {{visit_type.type}} </td>
        {% for p_key in visit_type[p_keys] %}
            {% for sec_key in p_key[it_names] %}
                <td class="value">{{sec_key|int}}</td>
            {% endfor %}
        {% endfor %}
    </tr>


    {% endfor %}
</table>
{%- endmacro %}

{% block title %}{{report.data.project_region|e}} &middot; Mental Health Report  &middot; Week {{ report.data.epi_week_num }}{% endblock title %}
{% block body %}
<!-- CONTENT -->
<div class="page-header">
    <h2>     <span 
	  class="flag-icon flag-icon-{{report.flag}}"
	  style="background-image: url(/static/img/flags/4x3/{{report.flag}}.svg) !important;"
      >
      </span>
    <img class="moh-title-logo" src="/static/img/{{content['footer']['logos']['country_partner']}}"> 
        <span class="hidden-xs">{{report.data.project_region|e}} &middot; </span> {{ _('Mental Health Report') }}
    <span class="report-week">
        {{ report.data.start_date|datetime_from_json|datetime('dd MMMM YYYY') }} - {{ report.data.end_date|datetime_from_json|datetime('dd MMMM YYYY') }}
    </span>
  </h2>
</div>

<div class="row">
  <!-- Visit type / Nationality -->
  <div class="col-sm-12">
    <div class="chart-wrapper">
      <div class="chart-title">{{ _('Visit type by nationality') }}</div>
      <div class="table-title">{{ _('Table 1: Patients nationality on different visit types.') }}</div>
      <div class="table-wrapper table-responsive">
          {{ table(report["table_1_data"], percent=True, p_keys="nationalities", s_keys="genders", it_names="gen_vals") }}
      </div>
    </div>
  </div>
</div>

<div class="row">
  <!-- Visit type / Age -->
  <div class="col-sm-12">
    <div class="chart-wrapper">
      <div class="chart-title">{{ _('Visit type by age') }}</div>
      <div class="table-title" style="page-break-before: always">{{ _('Table 2: Breakdown of patients age and gender') }}</div>
      <div class="table-wrapper table-responsive">
          {{ table(report["table_2_data"], percent=True, p_keys="age_categories", s_keys="genders", it_names="gen_vals") }}
      </div>
    </div>
  </div>
</div>

<div class="row">
  <!-- Governate / nationality -->
  <div class="col-sm-12">
    <div class="chart-wrapper">
      <div class="chart-title">{{ _('Nationality by governorate') }}</div>
      <div class="table-title">{{ _('Table 3: Nationality of patients with reported mental health condition in each governate.') }}</div>
      <div class="table-wrapper table-responsive">
          {{ table(report["table_3_data"], percent=True, p_keys="nationalities", s_keys="genders", it_names="gen_vals") }}
      </div>
    </div>
  </div>
</div>
<div class="row">
  <!-- Governate / age -->
  <div class="col-sm-12">
    <div class="chart-wrapper">
      <div class="chart-title">{{ _('Age by governorate') }}</div>
      <div class="table-title">{{ _('Table 4: Age of patients with reported mental health condition in each governate.') }}</div>
          {{ table(report["table_4_data"], percent=True, p_keys="age_categories", s_keys="genders", it_names="gen_vals") }}
      <div class="table-wrapper table-responsive">
      </div>
    </div>
  </div>
</div>

<div class="row">
  <!-- Diseases / nationality -->
  <div class="col-sm-12">
    <div class="chart-wrapper">
      <div class="chart-title">{{ _('Nationality by condition') }}</div>
      <div class="table-title" style="page-break-before: always">{{ _('Table 5: Patients nationality per disease.') }}</div>
      <div class="table-wrapper table-responsive">
          {{ table(report["table_5_data"], percent=True, p_keys="nationalities", s_keys="genders", it_names="gen_vals") }}
      </div>
    </div>
  </div>
</div>
<div class="row">
  <!-- Diseases / age -->
  <div class="col-sm-12">
    <div class="chart-wrapper">
      <div class="chart-title">{{ _('Age by condition') }}</div>
      <div class="table-title" style="page-break-before: always">{{ _('Table 6: Age of patients with different conditions.') }}</div>
      <div class="table-wrapper table-responsive">
          {{ table(report["table_6_data"], percent=True, p_keys="age_categories", s_keys="genders", it_names="gen_vals") }}
      </div>
    </div>
  </div>
</div>

{% endblock body %}
{% block extra_js %}
<!-- JAVASCRIPT DATA FOR CHARTS -->
{% endblock extra_js %}

